$: << '../lib' << 'lib'

require 'eventmachine'
require 'em-http'

EventMachine.run {
	multi = EventMachine::MultiRequest.new

	reqs = [
			#'http://mobile.tesco.com/groceryapi/RESTService.aspx?COMMAND=CANCELORDER&contractId=108714222&sessionkey=SDCeab885da74b58bae55e4299d24a89OShi8zkYkQ8HTEZRo7&version=2.0',
			'http://mobile.tesco.com/groceryapi/RESTService.aspx?COMMAND=CHANGEBASKET&sessionkey=SDCe0a149ee641febae8900e3355f4ccvOFo1auaVpah5fX3sh&PRODUCTID=&CHANGEQUANTITY=0&version=2.0&SURCHARGEMSG=Y&GETLINEITEMS=Y&MULTIADD=Y&PRODUCTIDSWITHQUANTITIES=266386106~2|252528508~2|257163597~1|254917114~1|254385581~1|254917120~1|256926117~1|259006689~1|254854677~1|254854147~1|263588333~1|280609866~1|258043473~1|263588172~1|255599793~1|280404100~1|255599833~1|263588536~1|263674058~1|272947344~1',
			'http://mobile.tesco.com/groceryapi/RESTService.aspx?COMMAND=CHANGEBASKET&sessionkey=SDCe0a149ee641febae8900e3355f4ccvOFo1auaVpah5fX3sh&PRODUCTID=&CHANGEQUANTITY=0&version=2.0&SURCHARGEMSG=Y&GETLINEITEMS=Y&MULTIADD=Y&PRODUCTIDSWITHQUANTITIES=278362600~1|272947229~1|263587213~1|267703278~1|255180358~1|263588650~1|255089008~1|259006689~1|254917483~1|258935230~1',
			'http://mobile.tesco.com/groceryapi/RESTService.aspx?COMMAND=CHANGEBASKET&sessionkey=SDCe0a149ee641febae8900e3355f4ccvOFo1auaVpah5fX3sh&PRODUCTID=&CHANGEQUANTITY=0&version=2.0&SURCHARGEMSG=Y&GETLINEITEMS=Y&MULTIADD=Y&PRODUCTIDSWITHQUANTITIES=266386106~1|252528508~1|257163597~1|254917114~1|254385581~1|254917120~1|256926117~1|259006689~1|254854677~1|254854147~1|263588333~1|280609866~1|258043473~1|263588172~1|255599793~1|280404100~1|255599833~1|263588536~1|263674058~1|272947344~1',
	]

	reqs.each_with_index do |url, idx|
		http = EventMachine::HttpRequest.new(url, :connect_timeout => 1)
		req = http.get
		multi.add idx, req
	end

	multi.callback do
		p multi.responses[:callback]
		EventMachine.stop
	end
}
